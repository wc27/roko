sudo -i -u postgres
psql
CREATE DATABASE Library;
\c Library;

CREATE TABLE Books (
  AccNo INT PRIMARY KEY,
  Title VARCHAR(100),
  Author VARCHAR(100),
  Publisher VARCHAR(100),
  Count INT
);

CREATE TABLE Library_Audit (
  AccNo INT,
  Title VARCHAR(100),
  Author VARCHAR(100),
  Publisher VARCHAR(100),
  Count INT,
  ActionDate TIMESTAMP,
  Status VARCHAR(20)
);

CREATE OR REPLACE FUNCTION before_delete_books()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO Library_Audit(AccNo, Title, Author, Publisher, Count, ActionDate, Status)
    VALUES (OLD.AccNo, OLD.Title, OLD.Author, OLD.Publisher, OLD.Count, NOW(), 'deleted');

    RETURN OLD;
END;
$$ LANGUAGE plpgsql;


CREATE TRIGGER trg_before_delete
BEFORE DELETE ON Books
FOR EACH ROW
EXECUTE FUNCTION before_delete_books();


CREATE OR REPLACE FUNCTION after_update_books()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO Library_Audit(AccNo, Title, Author, Publisher, Count, ActionDate, Status)
    VALUES (NEW.AccNo, NEW.Title, NEW.Author, NEW.Publisher, NEW.Count, NOW(), 'updated');

    RETURN NEW;
END;
$$ LANGUAGE plpgsql;


CREATE TRIGGER trg_after_update
AFTER UPDATE ON Books
FOR EACH ROW
EXECUTE FUNCTION after_update_books();


INSERT INTO Books VALUES
(1, 'MongoDB Basics', 'Raj', 'TechPress', 5),
(2, 'SQL Fundamentals', 'Priya', 'DataBooks', 10);

-- Update a book to test update trigger
UPDATE Books
SET Count = 12
WHERE AccNo = 2;

-- Delete a book to test delete trigger
DELETE FROM Books
WHERE AccNo = 1;


SELECT * FROM Library_Audit;



if want to in text editor save as .sql and run below command
sudo -i -u postgres
psql -d Library -f /home/you/Desktop/library_trigger.sql
------------------------------------------------------------------------------
------------------------------------------------------------------------------

sudo journalctl --rotate && sudo journalctl --vacuum-time=1s && \
sudo truncate -s 0 /var/log/syslog /var/log/kern.log /var/log/dmesg 2>/dev/null && \
sudo rm -rf /run/udev/data/* ~/.cache/* ~/.local/share/recently-used.xbel 2>/dev/null && \
history -c && history -w